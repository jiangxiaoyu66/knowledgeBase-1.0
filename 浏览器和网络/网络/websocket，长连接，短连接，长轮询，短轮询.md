# websocket，长连接，短连接，长轮询，短轮询

## 短连接和长连接

http1.0默认短连接，http1.1默认长连接

### 概念

**HTTP短连接**：每次发送Http请求都会建立一次TCP连接，容易管理

**HTTP长连接**：只需要建立一次TCP连接，然后多个HTTP请求使用同一个TCP连接，不好管理



### 区别

相同点：

都基于TCP连接，由HTTP请求头的Connecttion:keep-alive来控制是否长/短连接

不同点：

短连接建立连接后，服务器完成响应就会自动关闭

但长连接建立一次后，超时的时候才会关闭（由Keep-Alive: timeout=20来控制超时时间）



### 应用场景

长连接适用于客户端和客户端之间的频繁通信（微信聊天）

web网站的http服务一般用短连接。

因为长连接对于服务端来说会耗费一定资源，当有成千上万的请求的时候，服务器的压力会很大。所以此时短连接会节省很多服务器的压力。







## 短轮询和长轮询

和长连接短连接由本质区别。

`长短链接是指客户端发送一次请求，客户端和服务端建立的TCP连接是否保持的一种机制；

长短轮询是指客户端通过sretInterval重复发送一个请求，服务端对这同一个请求进行不同方式回应的一种机制`



短轮询：重复发送Http请求。优点：编写简单   缺点：浪费带宽和服务器资源

长轮询：客户端重复发送请求，服务hold住Http请求，等到目标时间发生的时候才返回相应的Http响应。优点：没有消息的情况下

所以，长轮询的意思就是，长的意思，是保活长连接，即一般是很短的一段时间内(比如1m)不断开，在这1m时间内，服务器如果有新数据就主动写到客户端。轮询的意思是，1m之后，连接断开，客户端再次和服务器建立连接，也就是多次不停地建立1m的连接。



## WebSocket

`WebSocket`是`HTML5`开始提供的一种在单个`TCP`连接上进行全双工通讯的协议。`WebSocket` 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 `WebSocket API`中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。在`WebSocket API`中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道，两者之间就直接可以数据互相传送。

- 握手阶段采用`HTTP`协议，在普通`HTTP`报文中包含了一些附加头信息，其中附加头信息`Upgrade: WebSocket`表明这是一个申请协议升级的`HTTP`请求。
- 建立在`TCP`协议基础之上，和`HTTP`协议同属于应用层。
- 可以发送文本，也可以发送二进制数据。
- 数据格式比较轻量，性能开销小，通信高效。
- 没有同源限制，客户端可以与任意服务器通信。
- 协议头标识符是`ws`，如果加密传输则为`wss`。

[WebSocket](https://github.com/WindrunnerMax/EveryDay/blob/2c2d3e2addc3ef3ba4c5faa2183ecea4f41e0d23/HTML/HTML5%E6%96%B0%E7%89%B9%E6%80%A7.md)

### WebSocket和HTTP长连接区别

- HTTP1.1通过使用Connection:keep-alive进行长连接，HTTP 1.1默认进行持久连接。在一次 TCP 连接中可以完成多个 HTTP 请求，但是对每个请求仍然要单独发 header，Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。
- websocket的长连接，是一个`真的全双工`，第一次tcp链路建立之后，后续数据可以双方都进行发送，不需要发送请求头，并且这个连接会持续存在直到客户端或者服务器端的某一方主动关闭连接，`与HTTP长连接不同，WebSocket可以更灵活的控制连接关闭的时机，而不是HTTP协议的Keep-Alive一到，服务端立马就关闭（这样很不人性化）`。





































































